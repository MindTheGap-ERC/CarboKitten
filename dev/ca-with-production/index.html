<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model with CA and Production · CarboKitten</title><meta name="title" content="Model with CA and Production · CarboKitten"/><meta property="og:title" content="Model with CA and Production · CarboKitten"/><meta property="twitter:title" content="Model with CA and Production · CarboKitten"/><meta name="description" content="Documentation for CarboKitten."/><meta property="og:description" content="Documentation for CarboKitten."/><meta property="twitter:description" content="Documentation for CarboKitten."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CarboKitten</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../bosscher-1992/">Bosscher and Schlager 1992</a></li><li class="is-active"><a class="tocitem" href>Model with CA and Production</a><ul class="internal"><li><a class="tocitem" href="#Complete-example"><span>Complete example</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li></ul></li><li><a class="tocitem" href="../model-alcap/">ALCAPS</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../cases/tabular-sea-level/">Tabular Sea Levels</a></li></ul></li><li><a class="tocitem" href="../architecture/">Architecture</a></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../components/components/">Components</a></li><li><a class="tocitem" href="../components/tag/">Tags</a></li><li><a class="tocitem" href="../components/boxes/">Boxes</a></li><li><a class="tocitem" href="../components/time/">Time</a></li><li><a class="tocitem" href="../components/facies/">Facies</a></li><li><a class="tocitem" href="../components/cellular-automata/">Cellular Automata</a></li><li><a class="tocitem" href="../components/waterdepth/">Water Depth</a></li><li><a class="tocitem" href="../components/production/">Production</a></li><li><a class="tocitem" href="../components/hdf5/">HDF5 Writer</a></li><li><a class="tocitem" href="../components/sediment_buffer/">Sediment Buffers</a></li><li><a class="tocitem" href="../active-layer-transport/">Active Layer Transport</a></li></ul></li><li><a class="tocitem" href="../visualization/">Visualizations</a></li><li><span class="tocitem">CarboCAT</span><ul><li><a class="tocitem" href="../carbocat/">Summary</a></li><li><a class="tocitem" href="../carbocat-ca/">Cellular Automaton</a></li></ul></li><li><span class="tocitem">Denudation</span><ul><li><a class="tocitem" href="../denudation/denudation/">Denudation</a></li><li><a class="tocitem" href="../denudation/empirical/">Empirical Denudation</a></li><li><a class="tocitem" href="../denudation/chemical/">Chemical Dissolution</a></li><li><a class="tocitem" href="../denudation/physical_erosion/">Physical Erosion</a></li></ul></li><li><span class="tocitem">Output</span><ul><li><a class="tocitem" href="../data-export/">CSV Export</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../unitful/">Unitful</a></li><li><a class="tocitem" href="../boxes/">Boxes</a></li><li><a class="tocitem" href="../stencils/">Stencils</a></li><li><a class="tocitem" href="../utility/">Utility</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Models</a></li><li class="is-active"><a href>Model with CA and Production</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model with CA and Production</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MindTheGap-ERC/CarboKitten.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MindTheGap-ERC/CarboKitten.jl/blob/main/docs/transpiled/ca-with-production.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="CA-with-production"><a class="docs-heading-anchor" href="#CA-with-production">CA with production</a><a id="CA-with-production-1"></a><a class="docs-heading-anchor-permalink" href="#CA-with-production" title="Permalink"></a></h1><p>This model combines BS92 production with the B13 cellular automaton. This production model is implemented in the <a href="../components/production/"><code>CAProduction</code> component</a>.</p><p><img src="../fig/cap1-summary.png" alt="Stratigraphy, production and subsidence under oscillating sea level."/></p><h2 id="Complete-example"><a class="docs-heading-anchor" href="#Complete-example">Complete example</a><a id="Complete-example-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-example" title="Permalink"></a></h2><p>This example is running for 10000 steps to 1Myr on a 100 <span>$\times$</span> 50 grid, starting with a sloped height down to 50m. The <code>sea_level</code>, and <code>initial_depth</code> arguments are functions. The <code>phys_scale</code> argument translate pixels on the grid into physical metres. The <code>write_interval</code> indicates to write output every 10 iterations, summing the production over that range.</p><div class="noweb-label">file:<i>examples/model/cap/run.jl</i></div><pre><code class="language- julia hljs">#| creates: data/output/cap1.h5
#| requires: src/Model/CAP.jl

module Script

using CarboKitten
using CarboKitten.Model.CAP
using CarboKitten.Components.Common
using Unitful

const PERIOD = 200.0u&quot;kyr&quot;
const AMPLITUDE = 4.0u&quot;m&quot;

const FACIES = [
	    CAP.Facies(
        viability_range = (4, 10),
        activation_range = (6, 10),
        maximum_growth_rate = 500u&quot;m/Myr&quot;,
        extinction_coefficient = 0.8u&quot;m^-1&quot;,
        saturation_intensity = 60u&quot;W/m^2&quot;),

	    CAP.Facies(
        viability_range = (4, 10),
        activation_range = (6, 10),
        maximum_growth_rate = 400u&quot;m/Myr&quot;,
        extinction_coefficient = 0.1u&quot;m^-1&quot;,
        saturation_intensity = 60u&quot;W/m^2&quot;),

	    CAP.Facies(
        viability_range = (4, 10),
        activation_range = (6, 10),
        maximum_growth_rate = 100u&quot;m/Myr&quot;,
        extinction_coefficient = 0.005u&quot;m^-1&quot;,
        saturation_intensity = 60u&quot;W/m^2&quot;)
	]

	const INPUT = CAP.Input(
		tag = &quot;cap1&quot;,
		box = Common.Box{Shelf}(grid_size=(100, 50), phys_scale=150.0u&quot;m&quot;),
		time = TimeProperties(
			Δt = 200.0u&quot;yr&quot;,
			steps = 5000,
			write_interval = 10),
		sea_level = t -&gt; 4.0u&quot;m&quot; * sin(2π * t / 0.2u&quot;Myr&quot;),
		bedrock_elevation = (x, y) -&gt; - x / 300.0,
		subsidence_rate = 50.0u&quot;m/Myr&quot;,
		insolation = 400.0u&quot;W/m^2&quot;,
		facies = FACIES)

	main() = CarboKitten.run(Model{CAP}, INPUT, &quot;data/output/cap1.h5&quot;)
end

Script.main()</code></pre><p>This writes output to an HDF5 file that you may use for further analysis and visualization.</p><div class="noweb-label">file:<i>examples/model/cap/plot.jl</i></div><pre><code class="language- julia hljs">#| creates: docs/src/_fig/cap1-summary.png
#| requires: data/output/cap1.h5
#| collect: figures
using GLMakie
using CarboKitten.Visualization

save(&quot;docs/src/_fig/cap1-summary.png&quot;, summary_plot(&quot;data/output/cap1.h5&quot;))</code></pre><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><div class="component-dag" style="overflow: scroll"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.50.0 (20211204.2007)
 -->
<!-- Pages: 1 -->
<svg width="781pt" height="580pt"
 viewBox="0.00 0.00 780.50 580.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 576)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-576 776.5,-576 776.5,4 -4,4"/>
<!-- Boxes -->
<g id="node1" class="node">
<title>Boxes</title>
<path fill="none" stroke="black" d="M542,-572C542,-572 404,-572 404,-572 398,-572 392,-566 392,-560 392,-560 392,-505 392,-505 392,-499 398,-493 404,-493 404,-493 542,-493 542,-493 548,-493 554,-499 554,-505 554,-505 554,-560 554,-560 554,-566 548,-572 542,-572"/>
<polyline fill="none" stroke="black" points="399,-541.5 547,-541.5 "/>
<text text-anchor="start" x="449.5" y="-550.3" font-family="Times,serif" font-weight="bold" font-size="14.00">Boxes</text>
<polygon fill="#cccccc" stroke="transparent" points="399,-518.5 399,-541.5 446,-541.5 446,-518.5 399,-518.5"/>
<polyline fill="none" stroke="black" points="399,-518.5 446,-518.5 446,-541.5 399,-541.5 "/>
<text text-anchor="start" x="403" y="-526.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="446,-518.5 446,-541.5 500,-541.5 500,-518.5 446,-518.5"/>
<polygon fill="none" stroke="black" points="446,-518.5 446,-541.5 500,-541.5 500,-518.5 446,-518.5"/>
<text text-anchor="start" x="450" y="-526.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="500,-518.5 500,-541.5 547,-541.5 547,-518.5 500,-518.5"/>
<polyline fill="none" stroke="black" points="547,-541.5 500,-541.5 500,-518.5 547,-518.5 "/>
<text text-anchor="start" x="504" y="-526.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="446,-499.5 446,-518.5 "/>
<text text-anchor="start" x="403" y="-506.5" font-family="monospace" font-size="10.00">box</text>
<polyline fill="none" stroke="black" points="500,-499.5 500,-518.5 "/>
<text text-anchor="start" x="450" y="-506.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="503" y="-506.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- WaterDepth -->
<g id="node7" class="node">
<title>WaterDepth</title>
<path fill="none" stroke="black" d="M336,-457C336,-457 84,-457 84,-457 78,-457 72,-451 72,-445 72,-445 72,-352 72,-352 72,-346 78,-340 84,-340 84,-340 336,-340 336,-340 342,-340 348,-346 348,-352 348,-352 348,-445 348,-445 348,-451 342,-457 336,-457"/>
<polyline fill="none" stroke="black" points="79,-426.5 341,-426.5 "/>
<text text-anchor="start" x="162.5" y="-435.3" font-family="Times,serif" font-weight="bold" font-size="14.00">WaterDepth</text>
<polygon fill="#cccccc" stroke="transparent" points="79,-403.5 79,-426.5 190,-426.5 190,-403.5 79,-403.5"/>
<polyline fill="none" stroke="black" points="79,-403.5 190,-403.5 190,-426.5 79,-426.5 "/>
<text text-anchor="start" x="83" y="-411.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="190,-403.5 190,-426.5 244,-426.5 244,-403.5 190,-403.5"/>
<polygon fill="none" stroke="black" points="190,-403.5 190,-426.5 244,-426.5 244,-403.5 190,-403.5"/>
<text text-anchor="start" x="194" y="-411.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="244,-403.5 244,-426.5 341,-426.5 341,-403.5 244,-403.5"/>
<polyline fill="none" stroke="black" points="341,-426.5 244,-426.5 244,-403.5 341,-403.5 "/>
<text text-anchor="start" x="248" y="-411.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="190,-384.5 190,-403.5 "/>
<text text-anchor="start" x="83" y="-391.5" font-family="monospace" font-size="10.00">sea_level</text>
<polyline fill="none" stroke="black" points="244,-384.5 244,-403.5 "/>
<text text-anchor="start" x="194" y="-391.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="247" y="-391.5" font-family="monospace" font-size="10.00">sediment_height</text>
<polyline fill="none" stroke="black" points="190,-365.5 190,-384.5 "/>
<text text-anchor="start" x="83" y="-372.5" font-family="monospace" font-size="10.00">bedrock_elevation</text>
<polyline fill="none" stroke="black" points="244,-365.5 244,-384.5 "/>
<text text-anchor="start" x="194" y="-372.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="247" y="-372.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="190,-346.5 190,-365.5 "/>
<text text-anchor="start" x="83" y="-353.5" font-family="monospace" font-size="10.00">subsidence_rate</text>
<polyline fill="none" stroke="black" points="244,-346.5 244,-365.5 "/>
<text text-anchor="start" x="194" y="-353.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="247" y="-353.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- Boxes&#45;&gt;WaterDepth -->
<g id="edge5" class="edge">
<title>Boxes&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M396.22,-492.97C376.72,-483.18 355.26,-472.41 334.07,-461.77"/>
<polygon fill="black" stroke="black" points="335.51,-458.58 325,-457.22 332.37,-464.83 335.51,-458.58"/>
</g>
<!-- CellularAutomaton -->
<g id="node9" class="node">
<title>CellularAutomaton</title>
<path fill="none" stroke="black" d="M760.5,-294.5C760.5,-294.5 499.5,-294.5 499.5,-294.5 493.5,-294.5 487.5,-288.5 487.5,-282.5 487.5,-282.5 487.5,-208.5 487.5,-208.5 487.5,-202.5 493.5,-196.5 499.5,-196.5 499.5,-196.5 760.5,-196.5 760.5,-196.5 766.5,-196.5 772.5,-202.5 772.5,-208.5 772.5,-208.5 772.5,-282.5 772.5,-282.5 772.5,-288.5 766.5,-294.5 760.5,-294.5"/>
<polyline fill="none" stroke="black" points="495,-264.5 766,-264.5 "/>
<text text-anchor="start" x="555" y="-273.3" font-family="Times,serif" font-weight="bold" font-size="14.00">CellularAutomaton</text>
<polygon fill="#cccccc" stroke="transparent" points="495,-241.5 495,-264.5 588,-264.5 588,-241.5 495,-241.5"/>
<polyline fill="none" stroke="black" points="495,-241.5 588,-241.5 588,-264.5 495,-264.5 "/>
<text text-anchor="start" x="499" y="-249.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="588,-241.5 588,-264.5 693,-264.5 693,-241.5 588,-241.5"/>
<polygon fill="none" stroke="black" points="588,-241.5 588,-264.5 693,-264.5 693,-241.5 588,-241.5"/>
<text text-anchor="start" x="592" y="-249.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="693,-241.5 693,-264.5 766,-264.5 766,-241.5 693,-241.5"/>
<polyline fill="none" stroke="black" points="766,-264.5 693,-264.5 693,-241.5 766,-241.5 "/>
<text text-anchor="start" x="697" y="-249.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="588,-222.5 588,-241.5 "/>
<text text-anchor="start" x="499" y="-229.5" font-family="monospace" font-size="10.00">ca_interval</text>
<polyline fill="none" stroke="black" points="693,-222.5 693,-241.5 "/>
<text text-anchor="start" x="592" y="-229.5" font-family="monospace" font-size="10.00">viability_range</text>
<text text-anchor="start" x="696" y="-229.5" font-family="monospace" font-size="10.00">ca</text>
<polyline fill="none" stroke="black" points="588,-203.5 588,-222.5 "/>
<text text-anchor="start" x="499" y="-210.5" font-family="monospace" font-size="10.00">ca_random_seed</text>
<polyline fill="none" stroke="black" points="693,-203.5 693,-222.5 "/>
<text text-anchor="start" x="592" y="-210.5" font-family="monospace" font-size="10.00">activation_range</text>
<text text-anchor="start" x="696" y="-210.5" font-family="monospace" font-size="10.00">ca_priority</text>
</g>
<!-- Boxes&#45;&gt;CellularAutomaton -->
<g id="edge12" class="edge">
<title>Boxes&#45;&gt;CellularAutomaton</title>
<path fill="none" stroke="black" d="M509.83,-492.98C519.38,-481.88 529.17,-469.4 537,-457 567.62,-408.47 593.16,-348.13 609.68,-304.51"/>
<polygon fill="black" stroke="black" points="613.04,-305.5 613.27,-294.91 606.49,-303.05 613.04,-305.5"/>
</g>
<!-- TimeIntegration -->
<g id="node2" class="node">
<title>TimeIntegration</title>
<path fill="none" stroke="black" d="M279,-572C279,-572 141,-572 141,-572 135,-572 129,-566 129,-560 129,-560 129,-505 129,-505 129,-499 135,-493 141,-493 141,-493 279,-493 279,-493 285,-493 291,-499 291,-505 291,-505 291,-560 291,-560 291,-566 285,-572 279,-572"/>
<polyline fill="none" stroke="black" points="136,-541.5 284,-541.5 "/>
<text text-anchor="start" x="144.5" y="-550.3" font-family="Times,serif" font-weight="bold" font-size="14.00">TimeIntegration</text>
<polygon fill="#cccccc" stroke="transparent" points="136,-518.5 136,-541.5 183,-541.5 183,-518.5 136,-518.5"/>
<polyline fill="none" stroke="black" points="136,-518.5 183,-518.5 183,-541.5 136,-541.5 "/>
<text text-anchor="start" x="140" y="-526.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="183,-518.5 183,-541.5 237,-541.5 237,-518.5 183,-518.5"/>
<polygon fill="none" stroke="black" points="183,-518.5 183,-541.5 237,-541.5 237,-518.5 183,-518.5"/>
<text text-anchor="start" x="187" y="-526.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="237,-518.5 237,-541.5 284,-541.5 284,-518.5 237,-518.5"/>
<polyline fill="none" stroke="black" points="284,-541.5 237,-541.5 237,-518.5 284,-518.5 "/>
<text text-anchor="start" x="241" y="-526.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="183,-499.5 183,-518.5 "/>
<text text-anchor="start" x="140" y="-506.5" font-family="monospace" font-size="10.00">time</text>
<polyline fill="none" stroke="black" points="237,-499.5 237,-518.5 "/>
<text text-anchor="start" x="187" y="-506.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="240" y="-506.5" font-family="monospace" font-size="10.00">step</text>
</g>
<!-- TimeIntegration&#45;&gt;WaterDepth -->
<g id="edge4" class="edge">
<title>TimeIntegration&#45;&gt;WaterDepth</title>
<path fill="none" stroke="black" d="M210,-492.97C210,-484.98 210,-476.34 210,-467.65"/>
<polygon fill="black" stroke="black" points="213.5,-467.47 210,-457.47 206.5,-467.47 213.5,-467.47"/>
</g>
<!-- CAP -->
<g id="node3" class="node">
<title>CAP</title>
<path fill="none" stroke="black" d="M205,-36C205,-36 175,-36 175,-36 169,-36 163,-30 163,-24 163,-24 163,-12 163,-12 163,-6 169,0 175,0 175,0 205,0 205,0 211,0 217,-6 217,-12 217,-12 217,-24 217,-24 217,-30 211,-36 205,-36"/>
<text text-anchor="start" x="173.5" y="-15.3" font-family="Times,serif" font-weight="bold" font-size="14.00">CAP</text>
</g>
<!-- Tag -->
<g id="node4" class="node">
<title>Tag</title>
<path fill="none" stroke="black" d="M150,-151C150,-151 12,-151 12,-151 6,-151 0,-145 0,-139 0,-139 0,-84 0,-84 0,-78 6,-72 12,-72 12,-72 150,-72 150,-72 156,-72 162,-78 162,-84 162,-84 162,-139 162,-139 162,-145 156,-151 150,-151"/>
<polyline fill="none" stroke="black" points="7,-120.5 155,-120.5 "/>
<text text-anchor="start" x="67" y="-129.3" font-family="Times,serif" font-weight="bold" font-size="14.00">Tag</text>
<polygon fill="#cccccc" stroke="transparent" points="7,-97.5 7,-120.5 54,-120.5 54,-97.5 7,-97.5"/>
<polyline fill="none" stroke="black" points="7,-97.5 54,-97.5 54,-120.5 7,-120.5 "/>
<text text-anchor="start" x="11" y="-105.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="54,-97.5 54,-120.5 108,-120.5 108,-97.5 54,-97.5"/>
<polygon fill="none" stroke="black" points="54,-97.5 54,-120.5 108,-120.5 108,-97.5 54,-97.5"/>
<text text-anchor="start" x="58" y="-105.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="108,-97.5 108,-120.5 155,-120.5 155,-97.5 108,-97.5"/>
<polyline fill="none" stroke="black" points="155,-120.5 108,-120.5 108,-97.5 155,-97.5 "/>
<text text-anchor="start" x="112" y="-105.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="54,-78.5 54,-97.5 "/>
<text text-anchor="start" x="11" y="-85.5" font-family="monospace" font-size="10.00">tag</text>
<polyline fill="none" stroke="black" points="108,-78.5 108,-97.5 "/>
<text text-anchor="start" x="58" y="-85.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="111" y="-85.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- Tag&#45;&gt;CAP -->
<g id="edge1" class="edge">
<title>Tag&#45;&gt;CAP</title>
<path fill="none" stroke="black" d="M126.91,-71.96C138.78,-62 151.21,-51.57 161.86,-42.62"/>
<polygon fill="black" stroke="black" points="164.22,-45.21 169.63,-36.1 159.72,-39.85 164.22,-45.21"/>
</g>
<!-- H5Writer -->
<g id="node5" class="node">
<title>H5Writer</title>
<path fill="none" stroke="black" d="M168.5,-263.5C168.5,-263.5 103.5,-263.5 103.5,-263.5 97.5,-263.5 91.5,-257.5 91.5,-251.5 91.5,-251.5 91.5,-239.5 91.5,-239.5 91.5,-233.5 97.5,-227.5 103.5,-227.5 103.5,-227.5 168.5,-227.5 168.5,-227.5 174.5,-227.5 180.5,-233.5 180.5,-239.5 180.5,-239.5 180.5,-251.5 180.5,-251.5 180.5,-257.5 174.5,-263.5 168.5,-263.5"/>
<text text-anchor="start" x="98.5" y="-242.8" font-family="Times,serif" font-weight="bold" font-size="14.00">H5Writer</text>
</g>
<!-- H5Writer&#45;&gt;CAP -->
<g id="edge2" class="edge">
<title>H5Writer&#45;&gt;CAP</title>
<path fill="none" stroke="black" d="M143.73,-227.28C151.72,-208.79 163.99,-178.37 171,-151 180.08,-115.52 185.2,-73.48 187.78,-46.54"/>
<polygon fill="black" stroke="black" points="191.29,-46.59 188.7,-36.32 184.31,-45.96 191.29,-46.59"/>
</g>
<!-- FaciesBase -->
<g id="node6" class="node">
<title>FaciesBase</title>
<path fill="none" stroke="black" d="M516,-438C516,-438 378,-438 378,-438 372,-438 366,-432 366,-426 366,-426 366,-371 366,-371 366,-365 372,-359 378,-359 378,-359 516,-359 516,-359 522,-359 528,-365 528,-371 528,-371 528,-426 528,-426 528,-432 522,-438 516,-438"/>
<polyline fill="none" stroke="black" points="373,-407.5 521,-407.5 "/>
<text text-anchor="start" x="403" y="-416.3" font-family="Times,serif" font-weight="bold" font-size="14.00">FaciesBase</text>
<polygon fill="#cccccc" stroke="transparent" points="373,-384.5 373,-407.5 420,-407.5 420,-384.5 373,-384.5"/>
<polyline fill="none" stroke="black" points="373,-384.5 420,-384.5 420,-407.5 373,-407.5 "/>
<text text-anchor="start" x="377" y="-392.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="420,-384.5 420,-407.5 474,-407.5 474,-384.5 420,-384.5"/>
<polygon fill="none" stroke="black" points="420,-384.5 420,-407.5 474,-407.5 474,-384.5 420,-384.5"/>
<text text-anchor="start" x="424" y="-392.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="474,-384.5 474,-407.5 521,-407.5 521,-384.5 474,-384.5"/>
<polyline fill="none" stroke="black" points="521,-407.5 474,-407.5 474,-384.5 521,-384.5 "/>
<text text-anchor="start" x="478" y="-392.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="420,-365.5 420,-384.5 "/>
<text text-anchor="start" x="377" y="-372.5" font-family="monospace" font-size="10.00">facies</text>
<polyline fill="none" stroke="black" points="474,-365.5 474,-384.5 "/>
<text text-anchor="start" x="424" y="-372.5" font-family="monospace" font-size="10.00"> </text>
<text text-anchor="start" x="477" y="-372.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- FaciesBase&#45;&gt;H5Writer -->
<g id="edge6" class="edge">
<title>FaciesBase&#45;&gt;H5Writer</title>
<path fill="none" stroke="black" d="M393.49,-358.95C381.87,-351.84 369.35,-345.07 357,-340 286.37,-310.98 255.32,-341.85 189,-304 175.05,-296.04 162.68,-283.16 153.4,-271.61"/>
<polygon fill="black" stroke="black" points="156.07,-269.33 147.22,-263.52 150.51,-273.59 156.07,-269.33"/>
</g>
<!-- FaciesBase&#45;&gt;CellularAutomaton -->
<g id="edge13" class="edge">
<title>FaciesBase&#45;&gt;CellularAutomaton</title>
<path fill="none" stroke="black" d="M494.13,-358.61C515.34,-341.11 540.76,-320.13 563.84,-301.09"/>
<polygon fill="black" stroke="black" points="566.09,-303.77 571.57,-294.71 561.63,-298.38 566.09,-303.77"/>
</g>
<!-- Production -->
<g id="node10" class="node">
<title>Production</title>
<path fill="none" stroke="black" d="M457.5,-304C457.5,-304 210.5,-304 210.5,-304 204.5,-304 198.5,-298 198.5,-292 198.5,-292 198.5,-199 198.5,-199 198.5,-193 204.5,-187 210.5,-187 210.5,-187 457.5,-187 457.5,-187 463.5,-187 469.5,-193 469.5,-199 469.5,-199 469.5,-292 469.5,-292 469.5,-298 463.5,-304 457.5,-304"/>
<polyline fill="none" stroke="black" points="206,-273.5 463,-273.5 "/>
<text text-anchor="start" x="290.5" y="-282.3" font-family="Times,serif" font-weight="bold" font-size="14.00">Production</text>
<polygon fill="#cccccc" stroke="transparent" points="206,-250.5 206,-273.5 275,-273.5 275,-250.5 206,-250.5"/>
<polyline fill="none" stroke="black" points="206,-250.5 275,-250.5 275,-273.5 206,-273.5 "/>
<text text-anchor="start" x="210" y="-258.3" font-family="Times,serif" font-size="14.00">Input</text>
<polygon fill="#cccccc" stroke="transparent" points="275,-250.5 275,-273.5 416,-273.5 416,-250.5 275,-250.5"/>
<polygon fill="none" stroke="black" points="275,-250.5 275,-273.5 416,-273.5 416,-250.5 275,-250.5"/>
<text text-anchor="start" x="279" y="-258.3" font-family="Times,serif" font-size="14.00">Facies</text>
<polygon fill="#cccccc" stroke="transparent" points="416,-250.5 416,-273.5 463,-273.5 463,-250.5 416,-250.5"/>
<polyline fill="none" stroke="black" points="463,-273.5 416,-273.5 416,-250.5 463,-250.5 "/>
<text text-anchor="start" x="420" y="-258.3" font-family="Times,serif" font-size="14.00">State</text>
<polyline fill="none" stroke="black" points="275,-231.5 275,-250.5 "/>
<text text-anchor="start" x="210" y="-238.5" font-family="monospace" font-size="10.00">insolation</text>
<polyline fill="none" stroke="black" points="416,-231.5 416,-250.5 "/>
<text text-anchor="start" x="279" y="-238.5" font-family="monospace" font-size="10.00">maximum_growth_rate</text>
<text text-anchor="start" x="419" y="-238.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="275,-212.5 275,-231.5 "/>
<text text-anchor="start" x="210" y="-219.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="416,-212.5 416,-231.5 "/>
<text text-anchor="start" x="279" y="-219.5" font-family="monospace" font-size="10.00">extinction_coefficient</text>
<text text-anchor="start" x="419" y="-219.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="275,-193.5 275,-212.5 "/>
<text text-anchor="start" x="210" y="-200.5" font-family="monospace" font-size="10.00"> </text>
<polyline fill="none" stroke="black" points="416,-193.5 416,-212.5 "/>
<text text-anchor="start" x="279" y="-200.5" font-family="monospace" font-size="10.00">saturation_intensity</text>
<text text-anchor="start" x="419" y="-200.5" font-family="monospace" font-size="10.00"> </text>
</g>
<!-- FaciesBase&#45;&gt;Production -->
<g id="edge9" class="edge">
<title>FaciesBase&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M417.9,-358.61C407.32,-344.48 395.05,-328.08 383.21,-312.26"/>
<polygon fill="black" stroke="black" points="385.86,-309.96 377.07,-304.05 380.26,-314.16 385.86,-309.96"/>
</g>
<!-- WaterDepth&#45;&gt;H5Writer -->
<g id="edge7" class="edge">
<title>WaterDepth&#45;&gt;H5Writer</title>
<path fill="none" stroke="black" d="M181.81,-339.98C170.47,-316.85 157.96,-291.32 148.88,-272.79"/>
<polygon fill="black" stroke="black" points="152.02,-271.23 144.47,-263.79 145.73,-274.31 152.02,-271.23"/>
</g>
<!-- WaterDepth&#45;&gt;Production -->
<g id="edge8" class="edge">
<title>WaterDepth&#45;&gt;Production</title>
<path fill="none" stroke="black" d="M257.23,-339.98C264.77,-330.8 272.62,-321.24 280.3,-311.9"/>
<polygon fill="black" stroke="black" points="283.05,-314.06 286.69,-304.11 277.64,-309.61 283.05,-314.06"/>
</g>
<!-- CAProduction -->
<g id="node8" class="node">
<title>CAProduction</title>
<path fill="none" stroke="black" d="M383.5,-129.5C383.5,-129.5 284.5,-129.5 284.5,-129.5 278.5,-129.5 272.5,-123.5 272.5,-117.5 272.5,-117.5 272.5,-105.5 272.5,-105.5 272.5,-99.5 278.5,-93.5 284.5,-93.5 284.5,-93.5 383.5,-93.5 383.5,-93.5 389.5,-93.5 395.5,-99.5 395.5,-105.5 395.5,-105.5 395.5,-117.5 395.5,-117.5 395.5,-123.5 389.5,-129.5 383.5,-129.5"/>
<text text-anchor="start" x="279.5" y="-108.8" font-family="Times,serif" font-weight="bold" font-size="14.00">CAProduction</text>
</g>
<!-- CAProduction&#45;&gt;CAP -->
<g id="edge3" class="edge">
<title>CAProduction&#45;&gt;CAP</title>
<path fill="none" stroke="black" d="M306.91,-93.29C283.89,-78.66 250.65,-57.54 225.49,-41.55"/>
<polygon fill="black" stroke="black" points="227.28,-38.54 216.96,-36.13 223.53,-44.45 227.28,-38.54"/>
</g>
<!-- CellularAutomaton&#45;&gt;CAProduction -->
<g id="edge10" class="edge">
<title>CellularAutomaton&#45;&gt;CAProduction</title>
<path fill="none" stroke="black" d="M522.3,-196.47C473.99,-174.93 419.49,-150.62 381.59,-133.72"/>
<polygon fill="black" stroke="black" points="382.89,-130.47 372.33,-129.59 380.04,-136.86 382.89,-130.47"/>
</g>
<!-- Production&#45;&gt;CAProduction -->
<g id="edge11" class="edge">
<title>Production&#45;&gt;CAProduction</title>
<path fill="none" stroke="black" d="M334,-186.99C334,-170.54 334,-153.38 334,-139.68"/>
<polygon fill="black" stroke="black" points="337.5,-139.52 334,-129.52 330.5,-139.52 337.5,-139.52"/>
</g>
</g>
</svg>
</div><div class="noweb-label">file:<i>src/Model/CAP.jl</i></div><pre><code class="language- julia hljs">@compose module CAP
@mixin Tag, H5Writer, CAProduction

using ..Common
using ..CAProduction: production
using ..TimeIntegration
using ..WaterDepth
using ModuleMixins: @for_each

export Input, Facies

function initial_state(input::Input)
    ca_state = CellularAutomaton.initial_state(input)
    for _ in 1:20
        CellularAutomaton.step!(input)(ca_state)
    end

    sediment_height = zeros(Height, input.box.grid_size...)
    return State(
        step=0, sediment_height=sediment_height,
        ca=ca_state.ca, ca_priority=ca_state.ca_priority)
end

function step!(input::Input)
    τ = production(input)
    step_ca = CellularAutomaton.step!(input)

    function (state::State)
        if mod(state.step, input.ca_interval) == 0
            step_ca(state)
        end

        prod = τ(state)
        Δη = sum(prod; dims=1)[1, :, :]
        state.sediment_height .+= Δη
        state.step += 1

        return H5Writer.DataFrame(
            production = prod,
            deposition = prod)
    end
end

function write_header(fid, input::AbstractInput)
    @for_each(P -&gt; P.write_header(fid, input), PARENTS)
end
end</code></pre><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../bosscher-1992/">« Bosscher and Schlager 1992</a><a class="docs-footer-nextpage" href="../model-alcap/">ALCAPS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 7 November 2024 15:29">Thursday 7 November 2024</span>. Using Julia version 1.10.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
